<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Web Ä‘á»c truyá»‡n Audio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            padding: 20px;
        }
        textarea {
            width: 100%;
            height: 220px;
            font-size: 16px;
            padding: 10px;
            border-radius: 8px;
            border: none;
            resize: vertical;
        }
        button {
            margin: 5px 5px 5px 0;
            padding: 10px 16px;
            font-size: 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .play { background: #22c55e; }
        .pause { background: #facc15; }
        .resume { background: #38bdf8; }
        .stop { background: #ef4444; }

        select, input {
            padding: 6px;
            margin: 5px;
            border-radius: 5px;
        }
        #story {
    margin-top: 20px;
    background: #020617;
    padding: 15px;
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
}

#story span {
    display: block;
    margin-bottom: 8px;
    line-height: 1.6;
}

#story .active {
    background: #fde68a;
    color: #000;
    padding: 4px;
    border-radius: 4px;
}

    </style>
</head>
<body>

<h2>ğŸ“– Web Ä‘á»c vÄƒn báº£n / truyá»‡n Audio</h2>

<textarea id="text"></textarea>

<div id="story"></div>

<br><br>


<br><br>

<label>ğŸ™ Giá»ng:</label>
<select id="voiceSelect"></select>

<label>âš¡ Tá»‘c Ä‘á»™:</label>
<input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
<span id="rateValue">1</span>

<br><br>

<button class="play" onclick="speak()">â–¶ Äá»c</button>
<button class="pause" onclick="pause()">â¸ Táº¡m dá»«ng</button>
<button class="resume" onclick="resume()">â¯ Tiáº¿p tá»¥c</button>
<button class="stop" onclick="stopSpeak()">â¹ Dá»«ng</button>

<script>
const synth = window.speechSynthesis;
const voiceSelect = document.getElementById("voiceSelect");
const rateInput = document.getElementById("rate");

let chunks = [];
let currentIndex = 0;
let isPaused = false;

function loadVoices() {
    const voices = synth.getVoices();
    voiceSelect.innerHTML = "";
    voices.forEach((voice, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(opt);
    });
}

loadVoices();
speechSynthesis.onvoiceschanged = loadVoices;

/* Cáº®T TEXT THÃ€NH NHIá»€U ÄOáº N */
function splitText(text, maxLength = 250) {
    let result = [];
    let current = "";

    text.split(/(\.|\?|!|\n)/).forEach(part => {
        if ((current + part).length > maxLength) {
            result.push(current);
            current = part;
        } else {
            current += part;
        }
    });

    if (current.trim() !== "") result.push(current);
    return result;
}
function renderStory() {
    const container = document.getElementById("story");
    container.innerHTML = "";

    chunks.forEach((c, i) => {
        const span = document.createElement("span");
        span.id = "chunk-" + i;
        span.innerText = c;
        container.appendChild(span);
    });
}

function highlight(index) {
    document.querySelectorAll("#story span")
        .forEach(s => s.classList.remove("active"));

    const el = document.getElementById("chunk-" + index);
    if (el) {
        el.classList.add("active");
        el.scrollIntoView({ behavior: "smooth", block: "center" });
    }
}


/* Äá»ŒC Tá»ªNG ÄOáº N */
function speakChunk() {
    if (currentIndex >= chunks.length || isPaused) return;

    highlight(currentIndex);
    const utter = new SpeechSynthesisUtterance(chunks[currentIndex]);
    const voices = synth.getVoices();

    utter.voice = voices[voiceSelect.value];
    utter.rate = rateInput.value;
    utter.lang = "vi-VN";

    utter.onend = () => {
        currentIndex++;
        speakChunk();
    };

    synth.speak(utter);
}

/* Báº®T Äáº¦U Äá»ŒC */
function speak() {
    synth.cancel();
    isPaused = false;
    currentIndex = 0;

    const text = document.getElementById("text").value;
    chunks = splitText(text);

    renderStory();   // â† THÃŠM
    speakChunk();
}


/* Táº M Dá»ªNG */
function pause() {
    isPaused = true;
    synth.pause();
}

/* TIáº¾P Tá»¤C */
function resume() {
    if (isPaused) {
        isPaused = false;
        synth.resume();
    }
}

/* Dá»ªNG Háº²N */
function stopSpeak() {
    synth.cancel();
    currentIndex = 0;
    isPaused = false;
}
</script>


</body>
</html>
